syntax = "proto3";

// import "shared.proto";

package dfs.master_server;

service MasterService {
  rpc RegisterChunkServer(RegisterChunkServerRequest) returns (RegisterChunkServerResponse) {}

  rpc ListChunkServers(ListChunkServersRequest) returns (ListChunkServersResponse) {}

  rpc SendHeartbeat(HeartbeatRequest) returns (HeartbeatResponse) {}

  rpc UploadFile(UploadFileRequest) returns (UploadFileResponse) {}

  rpc DownloadFile(DownloadFileRequest) returns (DownloadFileResponse) {}
}

message RegisterChunkServerRequest {
  string server_id = 1;
  string server_address = 2;
}

message RegisterChunkServerResponse {
  bool success = 1;
}

message ListChunkServersRequest {
}

message ListChunkServersResponse {
  repeated string server_address = 1;
}

message HeartbeatRequest {
  string server_id = 1;
}

message HeartbeatResponse {
  bool success = 1;
}

message UploadFileRequest {
  string file_name = 1;
  string chunk_id = 2;
}

message UploadFileResponse {
  uint64 chunk_id = 1;
  repeated ChunkLocation chunk_locations = 2; 
}

message DownloadFileRequest {
  string file_name = 1;
}

message DownloadFileResponse {
  repeated ChunkMetadata chunks = 1;
}

message ChunkMetadata {
  uint64 chunk_id = 1;
  repeated ChunkLocation locations = 2; 
}

message ChunkLocation {
  string address = 2;
}